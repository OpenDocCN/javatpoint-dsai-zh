# 事务控制转换

> 原文:[https://www . javatpoint . com/transaction-control-transformation](https://www.javatpoint.com/transaction-control-transformation)

事务控制转换是一种活跃且相互关联的转换。它允许我们基于通过事务控制转换的一组行来提交和回滚事务。

提交和回滚操作非常重要，因为它保证了数据的可用性。

事务是由提交或回滚行绑定的一组行。我们可以根据输入行数的变化来定义事务。我们还可以根据按公共键排序的一组行来识别事务，例如员工标识或订单输入日期。

当处理大量数据时，可能会出现将数据提交给目标的情况。如果提交执行得太快，将会给系统带来开销。

如果提交执行得太晚，那么在失败的情况下，就有可能丢失数据。因此事务控制转换提供了灵活性。

在 PowerCenter 中，事务控制转换在以下级别定义，例如:

*   **在映射中:**在映射中，我们使用事务控制转换来确定事务。我们在事务控制转换中使用表达式来定义事务。我们可以根据表达式的返回值选择提交、回滚或继续，而无需任何事务更改。
*   **在会话中:**我们为用户定义的提交配置一个会话。如果集成服务无法将任何行转换或写入目标，那么我们可以选择提交或回滚事务。

当我们运行会话时，集成服务为进入转换的每一行计算表达式。当它计算已提交的行时，它会将事务中的所有行提交给一个或多个目标。当集成服务评估回滚行时，它会从目标回滚事务中的所有行。

如果映射有一个平面文件作为目标，那么集成服务可以每次为新事务生成一个输出文件。我们可以动态命名目标平面文件。下面是动态创建平面文件的例子——动态平面文件创建。

### 提交和回滚命令

事务控制转换中有五个内置变量可用于处理操作。

1.  **TC _ CONTINUE _ TRANSACTION**
    集成服务不对该行执行任何事务更改。这是表达式的默认值。
2.  **TC_COMMIT_BEFORE**
    集成服务提交事务，开始新的事务，并将当前行写入目标。当前行在新事务中。
    在 tc_commit_before 中，当发现该标志被设置时，则在处理当前行之前执行提交。
3.  **TC_COMMIT_AFTER**
    集成服务将当前行写入目标，提交事务，并开始新的事务。当前行在提交的事务中。
    在 tc_commit_after 中，处理当前行，然后执行提交。
4.  **TC_ROLLBACK_BEFORE**
    集成服务回滚当前事务，开始新的事务，并将当前行写入目标。当前行在新事务中。
    在 tc_rollback_before 中，首先进行回滚，然后处理数据进行写入。
5.  **TC_ROLLBACK_AFTER**
    集成服务将当前行写入目标，回滚事务，并开始新的事务。当前行在回滚事务中。
    在 tc _ rollback _ 中，处理完数据后，进行回滚。

### 如何创建事务控制转换

按照以下步骤创建事务控制转换，例如:

**第一步**:前往地图设计器。

**第二步**:点击工具栏中的变换，点击**创建**按钮。

**第三步**:选择交易控制转换。

**第 4 步**:然后输入名称，点击**创建**按钮。

**第五步**:现在点击**完成**按钮。

**第六步**:我们可以将端口拖拽到事务控制转换中，也可以在端口选项卡中手动创建端口。

**第 7 步**:转到属性选项卡。

**第 8 步**:在交易控制条件中输入交易控制表达式。

### 配置事务控制转换

以下是可以在事务控制转换中配置的组件，例如:

1.  **变换标签**:可以重命名变换，添加描述。
2.  **端口选项卡**:可以创建输入或输出端口。
3.  **属性页签**:可以定义事务控制表达式和跟踪级别。
4.  **元数据扩展标签**:可以添加元数据信息。

### 事务控制表达式

我们可以在属性选项卡的事务控制条件选项中输入事务控制表达式。

事务控制表达式使用 IIF 函数对照条件检查每一行。

**语法**

以下是事务控制转换表达式的语法，例如:

```

IIF (condition, value1, value2)

```

例如:

```

IIF (dept_id=11, TC_COMMIT_BEFORE,TC_ROLLBACK_BEFORE)

```

### 例子

在下面的示例中，当 dept no =10 时，我们将向目标提交数据，并且发现该条件为真。

**步骤 1** :创建一个以 EMP 为源，EMP_TARGET 为目标的映射。

**步骤 2** :使用变换菜单创建一个新的变换，然后

1.  选择一个事务控制作为新的转换。
2.  输入转换名称 tc_commit_dept10。
3.  然后点击创建按钮。

**第三步**:创建交易控制转换，然后点击完成按钮。

**第 4 步**:将所有列从源限定符拖放到事务控制转换，然后将所有列从事务控制转换链接到目标表。

**第五步**:双击交易控制转换，然后在编辑属性窗口中:

1.  选择属性选项卡。
2.  点击交易控制编辑器图标。

**第 6 步**:在表达式编辑器中输入以下表达式:

1.  iif(deptno=10，tc_commit_before，tc_continue_transaction)。
2.  然后点击确定按钮。
3.  这意味着如果找到 deptno 10，则在目标中提交事务，否则继续当前处理。

**第 7 步**:点击上一窗口的确定按钮。

现在保存映射，并在创建会话和工作流后执行它。当在数据中找到部门编号 10 时，该映射会将数据提交给目标。

* * *